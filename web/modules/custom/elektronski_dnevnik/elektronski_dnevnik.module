<?php

use Drupal\Core\Access\AccessResult;
use Drupal\Core\Session\AccountInterface;

/**
 * Implements hook_menu_links_discovered_alter().
 * Modifies the menu links based on user login status and role.
 */
function elektronski_dnevnik_menu_links_discovered_alter(array &$links) {
  $current_user = \Drupal::currentUser();

  if ($current_user->isAuthenticated()) {
    // Dodajemo Logout link ako je korisnik prijavljen
    $links['elektronski_dnevnik.logout_link'] = [
      'title' => t('Logout'),
      'route_name' => 'user.logout',
      'menu_name' => 'main-menu',
      'weight' => 0,
    ];

    // Uklanjamo Login link ako je korisnik već ulogovan
    if (isset($links['elektronski_dnevnik.custom_login_link'])) {
      unset($links['elektronski_dnevnik.custom_login_link']);
    }
  }
  else {
    // Korisnik NIJE prijavljen - prikazujemo Login link
    $links['elektronski_dnevnik.custom_login_link'] = [
      'title' => t('Login'),
      'route_name' => 'elektronski_dnevnik.login',
      'menu_name' => 'main-menu',
      'weight' => 0,
    ];

    // Ako postoji logout link, uklanjamo ga
    if (isset($links['elektronski_dnevnik.logout_link'])) {
      unset($links['elektronski_dnevnik.logout_link']);
    }
  }
}

function elektronski_dnevnik_access_teacher() {
  // Dobijanje trenutnog korisnika
  $user = \Drupal::currentUser();

  // Proverite da li korisnik ima "administrator" ili "teacher" ulogu
  if ($user->hasRole('administrator') || $user->hasRole('teacher')) {
    return TRUE; // Dozvoliti pristup
  }
  else {
    return FALSE; // Onemogućiti pristup
  }
}